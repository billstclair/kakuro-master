<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>Kakuro Dojo</title>
  <script type="text/javascript" src="kakuro.js"></script>
  <script type="text/javascript" src="js/sha256.js"></script>
</head>

<body>
</body>

<script type="text/javascript">

// This must match modelVersion in SharedTypes.elm,
// or we ignore the saved state.
// Once it's in production, this file will need to have code to
// update old state to match current state.
var modelVersion = 4;

var storageName = 'kakuro-dojo';
var storedState = localStorage.getItem(storageName);
var startingState = storedState ? JSON.parse(storedState) : null;

if (startingState) {
  var version = startingState.version;
  if (version != modelVersion) {
    startingState = null;
  }
}

var kakuro = Elm.Kakuro.fullscreen(startingState);
kakuro.ports.setStorage.subscribe(function(state) {
    localStorage.setItem(storageName, JSON.stringify(state));
});

kakuro.ports.setTitle.subscribe(function(title) {
  document.title = title;
})

kakuro.ports.saveGame.subscribe(function(spec, gameState) {
  var hash = sha224(spec);
  localStorage.setItem(hash, JSON.stringify(gameState));
});

// This isn't restoring yet. It just sends the hash back
kakuro.ports.requestGame.subscribe(function(spec) {
  var hash = sha224(spec);
  app.ports.receiveGame.send(hash);
});

</script>

</html>
